/* Multi-Core malware project
 * Distributed DLL Injector Example
 * Marcus Botacin - 2017
 * Federal University of Paraná (UFPR)
 */

/* Include block */
#include<windows.h>

/* constants */
#define MAX_DLL_NAME 2048

/* Operation mode: SYNC or BUSY wait */
#define BUSY

/* define thread context structs */
#ifdef SYNC
typedef struct _ctx
{
	CRITICAL_SECTION cs;
	CONDITION_VARIABLE cv1,cv2;
	int pid;
	char dll[MAX_DLL_NAME];
	HANDLE proc;
	int size;
	LPVOID alloc;
	BOOL write;
	HMODULE k32;
	PTHREAD_START_ROUTINE tStart;
	HANDLE thread;
}context,*pcontext;
#else
typedef struct _ctx
{
	BOOL busy1,busy2;
	int pid;
	char dll[MAX_DLL_NAME];
	HANDLE proc;
	int size;
	LPVOID alloc;
	BOOL write;
	HMODULE k32;
	PTHREAD_START_ROUTINE tStart;
	HANDLE thread;
}context,*pcontext;
#endif

/* Prototypes */
DWORD WINAPI T1( LPVOID lpParam );
DWORD WINAPI T2( LPVOID lpParam );