/* MultiCore malware project
 * Simplest code-split strategy example
 * Marcus Botacin - 2017
 * Federal University of Paraná (UFPR)
 */

/* Include Block */
#include<Windows.h>
#include "functions.h"
#include <stdio.h>

/* File function */
/* Create a file on a given path */
void file(){
	HANDLE f;
	char var[MAX_LEN];
	char path[2*MAX_LEN];
	/* base directory will be the home */
	GetEnvironmentVariableA(FILE_BASE_PATH,var,MAX_LEN);
	/* file will be named test */
	sprintf(path,FILE_FULL_PATH,var);
	f=CreateFileA(path,GENERIC_WRITE,0,NULL,CREATE_ALWAYS,FILE_ATTRIBUTE_NORMAL,NULL);
	CloseHandle(f);
}

/* Process function */
/* Creates a new process in the system */
void proc()
{
	STARTUPINFOA si;
    PROCESS_INFORMATION pi;

    ZeroMemory( &si, sizeof(si) );
    si.cb = sizeof(si);
    ZeroMemory( &pi, sizeof(pi) );

	/* process will be calc.exe */
	CreateProcessA(NULL,   // No module name (use command line)
        PROC_NAME,        // Command line
        NULL,           // Process handle not inheritable
        NULL,           // Thread handle not inheritable
        FALSE,          // Set handle inheritance to FALSE
        NO_CREATION,              // No creation flags
        NULL,           // Use parent's environment block
        NULL,           // Use parent's starting directory 
        &si,            // Pointer to STARTUPINFO structure
        &pi );
}

/* Registry function */
/* Adds a new key in the registry */
void reg()
{
	HKEY p;
	/* key name/value will be test */
	char val[]=REG_KEY_NAME;
	RegCreateKeyA(HKEY_CURRENT_USER,REG_KEY_VALUE,&p);
	RegSetValueA(p,REG_KEY_VALUE,REG_SZ,val,CBDATA);
}